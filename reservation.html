<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ご予約 | ペットサロン わんにゃんパラダイス</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* カレンダー専用スタイル */
        .reservation-form-section {
            min-height: calc(100vh - 100px);
            padding: 50px 0;
            background: linear-gradient(135deg, #F5FFF5 0%, #FFFFF0 100%);
        }

        .form-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 40px;
        }

        .calendar-container {
            margin-bottom: 40px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background-color: #E8F5E9;
            border-radius: 10px;
        }

        .month-year {
            font-size: 1.5rem;
            color: #4CAF50;
            font-weight: bold;
        }

        .nav-button {
            background-color: #81C784;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        .nav-button:hover {
            background-color: #66BB6A;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 30px;
        }

        .day-header {
            text-align: center;
            padding: 10px;
            font-weight: bold;
            color: #4CAF50;
            background-color: #F1F8E9;
            border-radius: 5px;
        }

        .day-header.sunday {
            color: #FF6B6B;
        }

        .day-header.saturday {
            color: #4ECDC4;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background-color: white;
            position: relative;
        }

        .calendar-day:hover:not(.disabled):not(.selected) {
            border-color: #81C784;
            background-color: #F1F8E9;
            transform: scale(1.05);
        }

        .calendar-day.disabled {
            background-color: #F5F5F5;
            color: #BDBDBD;
            cursor: not-allowed;
        }

        .calendar-day.selected {
            background-color: #81C784;
            color: white;
            border-color: #66BB6A;
            font-weight: bold;
        }

        .calendar-day.today {
            border-color: #FFD54F;
            background-color: #FFF9C4;
        }

        .calendar-day.full {
            background-color: #FFEBEE;
            color: #E57373;
            cursor: not-allowed;
        }

        .calendar-day .slots {
            position: absolute;
            bottom: 2px;
            font-size: 0.7rem;
            color: #666;
        }

        .calendar-day.selected .slots {
            color: white;
        }

        /* 時間選択 */
        .time-selection {
            margin-bottom: 30px;
        }

        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .time-slot {
            padding: 10px;
            text-align: center;
            border: 2px solid #E0E0E0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            background-color: white;
        }

        .time-slot:hover:not(.disabled):not(.selected) {
            border-color: #81C784;
            background-color: #F1F8E9;
        }

        .time-slot.selected {
            background-color: #81C784;
            color: white;
            border-color: #66BB6A;
        }

        .time-slot.disabled {
            background-color: #F5F5F5;
            color: #BDBDBD;
            cursor: not-allowed;
        }

        .time-slot.reserved {
            background-color: #FFE0B2;
            color: #E65100;
            cursor: not-allowed;
            font-size: 0.9rem;
        }

        .time-slot.reserved::after {
            content: ' (予約中)';
            font-size: 0.8rem;
        }

        /* サービス時間表示 */
        .service-duration {
            margin-top: 20px;
            padding: 15px;
            background-color: #FFF9C4;
            border-radius: 10px;
            text-align: center;
            display: none;
        }

        .service-duration.show {
            display: block;
        }

        .duration-text {
            font-size: 1.1rem;
            color: #F57C00;
            font-weight: bold;
        }

        /* 選択した時間情報 */
        .selected-time-info {
            margin-top: 20px;
            padding: 15px;
            background-color: #E8F5E9;
            border-radius: 10px;
            text-align: center;
        }

        .time-info-text {
            font-size: 1rem;
            color: #2E7D32;
            font-weight: bold;
        }

        /* フォーム要素 */
        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #4CAF50;
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #81C784;
        }

        .service-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .service-option {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .service-option:hover {
            border-color: #81C784;
            background-color: #F1F8E9;
        }

        .service-option input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }

        .service-option.selected {
            background-color: #E8F5E9;
            border-color: #81C784;
        }

        .submit-button {
            width: 100%;
            padding: 15px;
            background-color: #81C784;
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 30px;
        }

        .submit-button:hover {
            background-color: #66BB6A;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .back-link {
            display: inline-block;
            margin-bottom: 30px;
            color: #4CAF50;
            text-decoration: none;
            transition: color 0.3s;
        }

        .back-link:hover {
            color: #66BB6A;
        }

        /* レスポンシブ対応 */
        @media (max-width: 768px) {
            .form-container {
                padding: 20px;
            }

            .calendar {
                gap: 2px;
            }

            .calendar-day {
                font-size: 0.9rem;
            }

            .time-slots {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="reservation-form-section">
        <div class="container">
            <a href="index.html" class="back-link">← トップページに戻る</a>
            
            <div class="form-container">
                <h1 class="section-title">ご予約フォーム</h1>
                
                <form id="reservationForm">
                    <!-- サービス選択 -->
                    <div class="form-group">
                        <label>ご希望のサービス（複数選択可）</label>
                        <div class="service-options">
                            <div class="service-option" onclick="toggleService(this)" data-duration="90">
                                <input type="checkbox" name="service" value="trimming">
                                <label>トリミング（約90分）</label>
                            </div>
                            <div class="service-option" onclick="toggleService(this)" data-duration="60">
                                <input type="checkbox" name="service" value="shampoo">
                                <label>シャンプー（約60分）</label>
                            </div>
                            <div class="service-option" onclick="toggleService(this)" data-duration="0">
                                <input type="checkbox" name="service" value="hotel">
                                <label>ペットホテル</label>
                            </div>
                            <div class="service-option" onclick="toggleService(this)" data-duration="30">
                                <input type="checkbox" name="service" value="spa">
                                <label>スパ・エステ（約30分）</label>
                            </div>
                        </div>
                        <div class="service-duration" id="serviceDuration">
                            <p class="duration-text">施術時間の目安：<span id="totalDuration">0</span>分</p>
                        </div>
                    </div>

                    <!-- カレンダー -->
                    <div class="calendar-container" id="calendarContainer" style="display: none;">
                        <h3>ご希望の日付を選択してください</h3>
                        <div class="calendar-header">
                            <button type="button" class="nav-button" onclick="previousMonth()">＜ 前月</button>
                            <div class="month-year" id="currentMonth">2024年1月</div>
                            <button type="button" class="nav-button" onclick="nextMonth()">次月 ＞</button>
                        </div>
                        <div class="calendar" id="calendar">
                            <div class="day-header sunday">日</div>
                            <div class="day-header">月</div>
                            <div class="day-header">火</div>
                            <div class="day-header">水</div>
                            <div class="day-header">木</div>
                            <div class="day-header">金</div>
                            <div class="day-header saturday">土</div>
                        </div>
                    </div>

                    <!-- 時間選択 -->
                    <div class="time-selection" id="timeSelection" style="display: none;">
                        <h3>ご希望の時間を選択してください</h3>
                        <div class="time-slots" id="timeSlots">
                            <div class="time-slot" onclick="selectTime(this)">9:00</div>
                            <div class="time-slot" onclick="selectTime(this)">9:30</div>
                            <div class="time-slot" onclick="selectTime(this)">10:00</div>
                            <div class="time-slot" onclick="selectTime(this)">10:30</div>
                            <div class="time-slot" onclick="selectTime(this)">11:00</div>
                            <div class="time-slot" onclick="selectTime(this)">11:30</div>
                            <div class="time-slot" onclick="selectTime(this)">13:00</div>
                            <div class="time-slot" onclick="selectTime(this)">13:30</div>
                            <div class="time-slot" onclick="selectTime(this)">14:00</div>
                            <div class="time-slot" onclick="selectTime(this)">14:30</div>
                            <div class="time-slot" onclick="selectTime(this)">15:00</div>
                            <div class="time-slot" onclick="selectTime(this)">15:30</div>
                            <div class="time-slot" onclick="selectTime(this)">16:00</div>
                            <div class="time-slot" onclick="selectTime(this)">16:30</div>
                            <div class="time-slot" onclick="selectTime(this)">17:00</div>
                            <div class="time-slot" onclick="selectTime(this)">17:30</div>
                        </div>
                        <div class="selected-time-info" id="selectedTimeInfo" style="display: none;">
                            <p class="time-info-text">選択した時間：<span id="selectedTimeSpan"></span> 〜 <span id="endTimeSpan"></span></p>
                        </div>
                    </div>

                    <!-- ペット情報 -->
                    <div class="form-group">
                        <label for="petType">ペットの種類</label>
                        <select id="petType" name="petType" required>
                            <option value="">選択してください</option>
                            <option value="dog-small">犬（小型）</option>
                            <option value="dog-medium">犬（中型）</option>
                            <option value="dog-large">犬（大型）</option>
                            <option value="cat">猫</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="petName">ペットのお名前</label>
                        <input type="text" id="petName" name="petName" required>
                    </div>

                    <div class="form-group">
                        <label for="petAge">年齢</label>
                        <input type="text" id="petAge" name="petAge" placeholder="例：3歳">
                    </div>

                    <!-- 飼い主情報 -->
                    <div class="form-group">
                        <label for="ownerName">飼い主様のお名前</label>
                        <input type="text" id="ownerName" name="ownerName" required>
                    </div>

                    <div class="form-group">
                        <label for="phone">電話番号</label>
                        <input type="tel" id="phone" name="phone" required placeholder="090-1234-5678">
                    </div>

                    <div class="form-group">
                        <label for="email">メールアドレス</label>
                        <input type="email" id="email" name="email" placeholder="example@email.com">
                    </div>

                    <div class="form-group">
                        <label for="notes">ご要望・備考</label>
                        <textarea id="notes" name="notes" rows="4" placeholder="カットのご要望や、ペットの性格など"></textarea>
                    </div>

                    <button type="submit" class="submit-button">予約を確定する</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        let currentDate = new Date();
        let selectedDate = null;
        let selectedTime = null;

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('currentMonth').textContent = `${year}年${month + 1}月`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            
            const calendar = document.getElementById('calendar');
            // Keep headers, remove date cells
            const headers = calendar.querySelectorAll('.day-header');
            calendar.innerHTML = '';
            headers.forEach(header => calendar.appendChild(header));
            
            // Empty cells before first day
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                calendar.appendChild(emptyCell);
            }
            
            // Date cells
            for (let date = 1; date <= lastDate; date++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';
                dayCell.textContent = date;
                
                const cellDate = new Date(year, month, date);
                const isToday = cellDate.toDateString() === today.toDateString();
                const isPast = cellDate < today;
                const isWednesday = cellDate.getDay() === 3;
                
                if (isToday) {
                    dayCell.classList.add('today');
                }
                
                if (isPast || isWednesday) {
                    dayCell.classList.add('disabled');
                } else {
                    // Random availability
                    const random = Math.random();
                    if (random > 0.8) {
                        dayCell.classList.add('full');
                        dayCell.innerHTML = date + '<div class="slots">満</div>';
                        dayCell.onclick = null; // 満席は選択不可
                    } else if (random > 0.5) {
                        dayCell.innerHTML = date + '<div class="slots">△</div>';
                        dayCell.onclick = () => selectDate(year, month, date);
                    } else {
                        dayCell.innerHTML = date + '<div class="slots">◯</div>';
                        dayCell.onclick = () => selectDate(year, month, date);
                    }
                }
                
                calendar.appendChild(dayCell);
            }
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        function selectDate(year, month, date) {
            const clickedDay = event.target.closest('.calendar-day');
            
            // 満席の日は選択できない
            if (clickedDay.classList.contains('full')) {
                return;
            }
            
            selectedDate = new Date(year, month, date);
            
            // Remove previous selection
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('selected');
            });
            
            // Add selection to clicked date
            clickedDay.classList.add('selected');
            
            // Show time selection
            document.getElementById('timeSelection').style.display = 'block';
            
            // Update time slots based on service duration
            updateTimeSlots();
        }

        function selectTime(element) {
            if (element.classList.contains('disabled')) return;
            
            const totalDuration = calculateTotalDuration();
            const timeSlots = document.querySelectorAll('.time-slot');
            const selectedIndex = Array.from(timeSlots).indexOf(element);
            const slotsNeeded = Math.ceil(totalDuration / 30);
            
            // Clear previous selection
            timeSlots.forEach(slot => {
                slot.classList.remove('selected', 'reserved');
            });
            
            // Check if we have enough consecutive slots
            let canReserve = true;
            for (let i = 0; i < slotsNeeded; i++) {
                if (selectedIndex + i >= timeSlots.length || timeSlots[selectedIndex + i].classList.contains('disabled')) {
                    canReserve = false;
                    break;
                }
            }
            
            if (!canReserve) {
                alert('選択した時間からは必要な時間を確保できません。他の時間を選択してください。');
                return;
            }
            
            // Mark selected time and reserve subsequent slots
            element.classList.add('selected');
            selectedTime = element.textContent;
            
            // Mark reserved slots
            for (let i = 1; i < slotsNeeded; i++) {
                timeSlots[selectedIndex + i].classList.add('reserved');
            }
            
            // Show selected time info
            const startTime = element.textContent;
            const endTimeMinutes = parseTimeToMinutes(startTime) + totalDuration;
            const endTime = formatMinutesToTime(endTimeMinutes);
            
            document.getElementById('selectedTimeSpan').textContent = startTime;
            document.getElementById('endTimeSpan').textContent = endTime;
            document.getElementById('selectedTimeInfo').style.display = 'block';
        }
        
        function parseTimeToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }
        
        function formatMinutesToTime(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return `${hours}:${mins.toString().padStart(2, '0')}`;
        }

        function toggleService(element) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            element.classList.toggle('selected', checkbox.checked);
            
            // Calculate total duration
            calculateTotalDuration();
            
            // Show calendar if at least one service is selected
            const selectedServices = document.querySelectorAll('.service-option.selected');
            if (selectedServices.length > 0) {
                document.getElementById('calendarContainer').style.display = 'block';
            } else {
                document.getElementById('calendarContainer').style.display = 'none';
                document.getElementById('timeSelection').style.display = 'none';
            }
            
            // Update time slots if date is selected
            if (selectedDate) {
                updateTimeSlots();
            }
        }
        
        function calculateTotalDuration() {
            let totalMinutes = 0;
            const selectedServices = document.querySelectorAll('.service-option.selected');
            
            selectedServices.forEach(service => {
                const duration = parseInt(service.getAttribute('data-duration') || 0);
                totalMinutes += duration;
            });
            
            document.getElementById('totalDuration').textContent = totalMinutes;
            
            if (totalMinutes > 0) {
                document.getElementById('serviceDuration').classList.add('show');
            } else {
                document.getElementById('serviceDuration').classList.remove('show');
            }
            
            return totalMinutes;
        }
        
        function updateTimeSlots() {
            const totalDuration = calculateTotalDuration();
            const timeSlots = document.querySelectorAll('.time-slot');
            const timeSlotsArray = Array.from(timeSlots);
            
            // Reset all slots
            timeSlots.forEach(slot => {
                slot.classList.remove('disabled', 'selected');
            });
            
            // Disable slots based on duration
            if (totalDuration > 0) {
                const slotsNeeded = Math.ceil(totalDuration / 30); // 30分単位
                
                timeSlotsArray.forEach((slot, index) => {
                    // ランダムに一部の時間帯を埋める
                    if (Math.random() > 0.7) {
                        slot.classList.add('disabled');
                    }
                    
                    // 終業時間に近い場合、長時間のサービスは受付不可
                    const remainingSlots = timeSlotsArray.length - index;
                    if (remainingSlots < slotsNeeded) {
                        slot.classList.add('disabled');
                    }
                });
            } else {
                // サービス未選択時は通常のランダム無効化
                timeSlots.forEach(slot => {
                    if (Math.random() > 0.7) {
                        slot.classList.add('disabled');
                    }
                });
            }
        }

        document.getElementById('reservationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('予約が完了しました！確認メールをお送りします。');
        });

        // Initialize calendar
        renderCalendar();
    </script>
</body>
</html>